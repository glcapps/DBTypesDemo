<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Databases vs. Application Logic Demo</title>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.39.0/min/vs/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/duckdb-wasm@1.20.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/pgmock@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">Databases vs. Application Logic: Stop Moving Data and Start Leveraging Your DB</h1>
        
        <div class="bg-gray-800 p-4 rounded-lg shadow-lg mb-6">
            <h2 class="text-lg font-semibold mb-2">DuckDB Query</h2>
            <div id="duckdb-editor" class="h-40 border rounded bg-gray-700"></div>
            <button class="mt-2 bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded" hx-on:click="runDuckDBQuery()">Run Query</button>
            <pre id="duckdb-output" class="bg-gray-700 p-2 mt-2 rounded"></pre>
        </div>
        
        <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-semibold mb-2">PostgreSQL Query (pgMock WASM)</h2>
            <div id="pg-editor" class="h-40 border rounded bg-gray-700"></div>
            <button class="mt-2 bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded" hx-on:click="runPGQuery()">Run Query</button>
            <pre id="pg-output" class="bg-gray-700 p-2 mt-2 rounded"></pre>
        </div>
    </div>
    
    <script>
        let duckDB, pgDB;
        
        async function initDatabases() {
            // Initialize DuckDB
            duckDB = new duckdb.AsyncDuckDB();
            await duckDB.instantiate();
            await duckDB.open({});
            
            // Initialize pgMock (full WASM Postgres)
            pgDB = new pgmock.Database();
            await pgDB.query("CREATE TABLE users (id SERIAL PRIMARY KEY, name TEXT, age INT);");
            await pgDB.query("INSERT INTO users (name, age) VALUES ('Alice', 30), ('Bob', 25);");
        }
        
        async function runDuckDBQuery() {
            const query = monaco.editor.getModels()[0].getValue();
            const result = await duckDB.query(query);
            document.getElementById("duckdb-output").textContent = JSON.stringify(result.toArray(), null, 2);
        }
        
        async function runPGQuery() {
            const query = monaco.editor.getModels()[1].getValue();
            const result = await pgDB.query(query);
            document.getElementById("pg-output").textContent = JSON.stringify(result.rows, null, 2);
        }
        
        require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.39.0/min/vs" } });
        require(["vs/editor/editor.main"], function () {
            monaco.editor.create(document.getElementById("duckdb-editor"), {
                value: "SELECT 42 AS answer;",
                language: "sql",
                theme: "vs-dark"
            });
            monaco.editor.create(document.getElementById("pg-editor"), {
                value: "SELECT * FROM users;",
                language: "sql",
                theme: "vs-dark"
            });
        });
        
        initDatabases();
    </script>
</body>
</html>